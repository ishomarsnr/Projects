<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Malware Detection Project</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <header>
        <h1>Malware Detection Using Machine Learning</h1>
        <nav>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="projects.html">Projects</a></li>
                <li><a href="contact.html">Contact</a></li>
            </ul>
        </nav>
    </header>
    <main>
        <section>
            <h2>Project Overview</h2>
            <p>This project involves detecting malware using various data analysis and machine learning techniques. The features are extracted from Portable Executable (PE) files, and a Random Forest classifier is trained to distinguish between malware and benign software.</p>
        </section>
        <section>
            <h2>Technologies Used</h2>
            <ul>
                <li>Python</li>
                <li>Scikit-learn</li>
                <li>TF-IDF Vectorization</li>
                <li>Random Forest Classifier</li>
            </ul>
        </section>
        <section>
            <h2>Project Details</h2>
            <p>The script performs the following steps:</p>
            <ol>
                <li>Extracts features such as imported DLLs and section names from PE files.</li>
                <li>Converts these features into numerical representations using TF-IDF vectorization.</li>
                <li>Combines the feature matrices into a single feature matrix.</li>
                <li>Splits the data into training and test sets.</li>
                <li>Trains a Random Forest classifier on the training set.</li>
                <li>Evaluates the trained model using a test dataset and prints the confusion matrix.</li>
            </ol>
        </section>
        <section>
            <h2>Code Example</h2>
            <pre>
                <code>
def get_section_names(sections):
    """Gets a list of section names from a PE file."""
    list_of_section_names = []
    for sec in sections:
        normalized_name = sec.replace("\\x00", "").replace('.','').lower()
        list_of_section_names.append(normalized_name)
    return ' '.join(list_of_section_names)

def obtainDllsSectionNames(dict_file):
    with open(dict_file,'rb') as mal_f:
        malt=pickle.load(mal_f)
    
    dlls={}
        
    imported_symbols = malt.get("Imported symbols")
    if imported_symbols:
        for imports in imported_symbols:
            for dllInfo in imports[1:]:
                if dllInfo["DLL"] not in dlls:
                    dlls[dllInfo["DLL"]]=[]
                dlls[dllInfo["DLL"]].append(dllInfo.get('Name'))
    else:
        print("No imported symbols found.")
    
    sections = malt.get("PE Sections") 
    section_names=[]

    if sections:
        for section in sections:
            print("Section Name:", section["Name"]['Value'])
            print("Virtual Size:", (section["Misc_VirtualSize"]['Value']))
            print("Raw Size:", (section["SizeOfRawData"]['Value']))
            section_names.append(section["Name"]['Value'])
    return dlls.keys(),section_names

def get_imports(dll_names):
    """Get a list of the imported dlls of a PE file."""
    dllstr=' '.join([dll.decode().split(".")[0].lower() for dll in dll_names])
    return dllstr

import pickle
import os

software_ids=[]
is_malicious=[]

imports_corpus = []
section_corpus = []
directories=['malware_d','benign_d']

for dataset_path in directories:
   
    samples=os.listdir('%s/' %dataset_path)
    
    for file in samples:
        print(file)
        software_ids.append(file)
        
        if dataset_path=='malware_d':
            is_malicious.append(1)
        else:
            is_malicious.append(0)
            
        try:
            tdict_file="%s/%s" %(dataset_path,file)
            

            tdll_names,tsection_names=obtainDllsSectionNames(tdict_file)

            imports_corpus.append(get_imports(tdll_names))
            section_corpus.append(get_section_names(tsection_names))

        except Exception as e:
            print(e)
            print("Unable to obtain imports from " + "%s/%s" %(dataset_path,file))

import_vect = TfidfVectorizer()
imports_transformed = import_vect.fit_transform(imports_corpus)

section_vect = TfidfVectorizer()
sections_transformed = section_vect.fit_transform(section_corpus)

mw_features = hstack(
    (   imports_transformed,
        sections_transformed)
)

software_id_train, software_id_test, features_train, features_test, labels_train, labels_test = train_test_split(
    software_ids, mw_features,is_malicious, test_size=0.3, random_state=11)

mal_clf = RandomForestClassifier(n_estimators=100)
mal_clf.fit(features_train, labels_train)

pred_test = mal_clf.predict(features_test)

print(confusion_matrix(labels_test,pred_test))
                </code>
            </pre>
        </section>
        <section>
            <h2>Results</h2>
            <p>The Random Forest classifier was able to accurately predict whether a file is malware or benign with a high degree of accuracy. The confusion matrix below shows the performance of the model:</p>
            <!-- Add image of the confusion matrix if available -->
            <!-- <img src="path_to_confusion_matrix_image.png" alt="Confusion Matrix"> -->
        </section>
        <section>
            <h2>GitHub Repository</h2>
            <p>You can view the full project and code on my <a href="https://github.com/yourusername/yourrepository" target="_blank">GitHub repository</a>.</p>
        </section>
    </main>
    <footer>
        <p>&copy; 2024 Your Name. All rights reserved.</p>
    </footer>
</body>
</html>
